# База даннных Mongo BD: 
Это **документо ориентированная** система управления базами данных. Для хранения данных **используется JSON формат**(JavaScript Object Notation). 
Данная БД не требует описание стуктуры таблиц. Данные храняться в виде `**коллекций и документов**`.
> Документ можно представить как хранилище **ключей и значений**.

Ключ представляет простую метку, с которым ассоциировано определенный кусок данных.
В MongoDB для каждого документа имеется уникальный идентификатор, который называется _id. И если явным образом не указать его значение, то MongoDB автоматически сгенерирует для него значение.
Если какому-то ключу не сопоставлено значение, то этот ключ просто опускается в документе и не употребляется.

Коллекции - коллекции могут содержать самые разные объекты, имеющие различную структуру и различный набор свойств.

![Пример данных](Пример%20данных%20в%20Mongo%20DB.jpg)

Структура приложений Mongo DB.
**mongod**: сервер баз данных MongoDB. Он обрабатывает запросы, управляет форматом данных и выполняет различные операции в фоновом режиме по управлению базами данных

**mongos**: служба маршрутизации MongoDB, которая помогает обрабатывать запросы и определять местоположение данных в кластере MongoDB

Скачать для локального использования можно по [ссылке.](https://www.mongodb.com/try/download/community) Выбрав соответствующую систему. 

Для подключения к БД можно использовать [Mongo DB shell.](https://www.mongodb.com/try/download/shell) Порт и хост по умолчанию mongodb://localhost:27017 или mongodb://127.0.0.1:27017.


# Использование различных команд для взаимодействия с БД: 

Просмотр Баз данных. 
```
show database
или 
show dbs
```
Использование конкретной БД (usersdb). *(Если такой нет - она будет создана)*.
```
use usersdb
```
Просмотр всех коллекций.
```
show collections
```

# Работа с данными 
Создание новой коллекции: 
> db.createCollection("Users")

Вставка новой коллекции users
``` JS
db.users.insertOne( { name: "Gusev_ae" } )
```
Добавление несколько документов в коллекцию
``` JSON
db.users.insertMany([
    {"name": "Bob", "age": 26, languages: ["english", "french"]}, 
    {"name": "Alice", "age": 31, languages:["german", "english"]}
    ])
```
Добавление документа возможно из заранее обьявленного документа: 
``` JSON
document=({"name": "Bill", "age": 32, languages: ["english", "french"]})
db.users.insertOne(document)
```

Вывод данных из коллекции 
```
 db.users.find()
```
Т.к. идентификатор не был задан, то `_id` сгенерируется автоматически. Важно помнить, что MongoBD - регистрозависимая. И коллекции Users и users - это разные системы. 
![](Вывод%20информации%20в%20MongoBD.jpg)

-----
# Типы значений в Mongo BD: 

* `String`: строковый тип данных, (для строк используется кодировка UTF-8)

* `Array` (массив): тип данных для хранения массивов элементов
* `Binary` data (двоичные данные): тип для хранения данных в бинарном формате
* `Boolean`: булевый тип данных, хранящий логические значения TRUE или FALSE, например, {"married": FALSE}
* `Date`: хранит дату в формате времени Unix
* `Double`: числовой тип данных для хранения чисел с плавающей точкой
* `Integer`: используется для хранения целочисленных значений размером 32 бита, например, {"age": 29}
* `Long`: используется для хранения целочисленных значений размером 64 бита
* `JavaScript`: тип данных для хранения кода javascript
* `Min key/Max key`: используются для сравнения значений с наименьшим/наибольшим элементов BSON
* `Null`: тип данных для хранения значения Null
* `Object`: объект, который содержит набор свойств
* `ObjectId`: тип данных для хранения id документа
* `Regular expression`: применяется для хранения регулярных выражений
* `Decimal128`: тип данных для хранения десятичных дробных чисел размером 128 бит, которые позволяют решить проблемы с проблемой точности вычислений при использовании дробных чисел, которые представляют тип Double.
* `Timestamp`: применяется для хранения времени

> **ВАЖНО:** Имя коллекции не должно содержать знака доллара ($), состоять не более чем 128 различных алфавитно-цифровых символов и знака подчеркивания. В то же время имя коллекции не должно начинаться с префикса system., так как он зарезервирован для внутренних коллекций.

## Возможность работы с коллециями:

В данном примере добавляются три документа в коллекцию users.

Для загузки файла в текущую базу данных применяется функция load(), в которую в качестве параметра передается путь к файлу:

`load("D:/users.js")`

В данном случае предполагается, что файл располагается по пути "D:/users.js" с содержимым:

``` JS
db.users.insertMany([
{"name": "Alice", "age": 31, languages: ["english", "french"]},
{"name": "Lene", "age": 29, languages: ["english", "spanish"]},
{"name": "Kate", "age": 30, languages: ["german", "russian"]}
])
```

## Поиск по неточному условию
Для поиска документов в которых требуется использовать не точные условия поиска используется конструкция вида: 
> db.Users.find({age:{$Оператор:значение}})

Опрераторы могут быть: 

`$lt` - меньше "<"

`$lte` - Меньше или равно "<="

`$gt` - Больше ">"

`$gte` - Больше или равно ">="

`$ne` - Не равен "<>"




## Выборка и фильтрация

Пример коа с применением фильтра: 
``` JS
db.Users.find({name: "Tom", age: 32})
```
Данный запрос аналогичен запросу в релиационной БД: 
```SQL
select * from Users where name = 'Tom' and age = 32
```
Если же требуется искать по полю у которого значение не определено, то можно воспользоваться конструкцией `({name: "Tom", languages: null})`

## Фильтрация по элементам массива
Поиск по элементу в массиве. 
`db.users.find({languages: "english"})`

Поиск по нескольким элементом в масиве: 
`db.users.find({languages: ["english", "german"]})`

> **ВАЖНО**: Причем именно в этом порядке, где "english" определен первым, а "german" - вторым.

Поиск по индексу в массиве 1-я позиция - "0"
`db.users.find({"languages.0": "english"})`

> Обратите внимание, что "languages.0" предоставляет сложное свойство и поэтому берется в кавычки. 

Если же в случае когда у нас стуктура в нутри массива предствалена в виде ключ значения. То можем после индекса, через точку обратиться к ключу. 

Выберем все документы, где в массиве friends свойство name первого элемента равно "Bob"
`db.users.find({"friends.0.name": "Bob"})`
Консольный вывод:

## Проекция
Выбор данных из документа конкретных полей. Для этого вторым аргументом требуется передать структуру ключ значения с полями. 
``` JS
db.users.find({}, {age: True, _id: False})
или
db.users.find({}, {age: 1, _id: 0})
```

Что бы вывести все поля кроме определенного: 
```
db.persons.find({name: "Tom"}, {age: 0})
```



# Использование JavaScript
Кроме выполнения запросов к базе данных мы можем выполнять выражения JavaScript. Например, мы можем создать какую-нибудь функцию и применять ее:


``` JavaScript
test> function sqrt(n) { return n*n; }
[Function: sqrt]
test> sqrt(5)
25
```

Например, найдем все документы, где поле age равно sqrt(5)+3:

>`test> db.users.find({age: sqrt(5)+3})`

---
## Использование регулярных выражений
Еще одной замечательной возможностью при построении запросов [`является использование регулярных`](https://regex101.com/) выражений. Например, поиск документов, в которых значение ключа name начинается с буквы B:

> db.users.find({name:/^B\w+/i})

## Поиск одиночного документа:

> db.users.findOne({name: "Tom"})


## Курсоры
Результат выборки, получаемой с помощью функции find, называется `курсором`. При необходимости мы можем передать курсор в отдельную переменную:

> var cursor = db.users.find()
> 
Дальнейшая работа с курсовами возможна с использованием языка JavaScript. или других языков использую специальные библиотеки. 